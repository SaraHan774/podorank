# Wine Game App - Product Requirements Document (PRD)

**프로젝트명:** 와인 동호회 실시간 게임 대시보드  
**버전:** 1.0  
**작성일:** 2025-12-15  
**상태:** 개발 계획 수립 완료

---

## 1. 프로젝트 개요

### 1.1 목표
와인 동호회 모임에서 참가자들이 손쉽게 와인 선호도를 기록하고, 실시간 멀티플레이 게임을 통해 게임화된 방식으로 와인을 테이스팅하는 Web App을 개발한다.

### 1.2 핵심 가치
- **빠른 참여:** 손가락 몇 번의 터치로 와인 선택 기록
- **실시간 상호작용:** 포도알 캐릭터를 움직여 와인을 선택하는 게임 메커닉
- **자동 기록:** 게임 종료 후 와인별/개인별 통계 자동 생성
- **접근성:** 로그인 불필요 (닉네임만 입력), 모든 플랫폼에서 접근 가능

### 1.3 대상 사용자
- 와인 동호회 멤버 (15-20명 규모 모임)
- 기술적 배경 불필요 (직관적 UI)

---

## 2. 기능 요구사항

### 2.1 게임 플레이 시스템

#### 2.1.1 기본 게임 흐름

**사전 준비:**
1. 마스터(주최자)가 앱에서 "새 게임 시작" 클릭
2. 오늘 마시는 와인 5개 등록 (이름 입력)
3. QR 코드 생성 → 참가자들이 스캔하여 입장
4. 참가자들이 닉네임 입력하여 대기

**게임 진행:**
- 6개 라운드 자동 진행
- 마스터가 각 라운드 시작 버튼 클릭
- 타이머 시작과 동시에 선택지 와인 표시
- 모든 플레이어가 조이스틱으로 포도알 캐릭터 조종
- 포도알을 원하는 와인 쪽으로 이동시켜 선택

#### 2.1.2 라운드 구성 (Option B - 6라운드)

| 라운드 | 선택지 개수 | 와인 조합 예시 | 타이머 | 특징 |
|--------|-----------|-------------|--------|------|
| Round 1 | 2개 | (와인1, 와인2) | 30초 | 워밍업 |
| Round 2 | 2개 | (와인1, 와인3) | 28초 | 선택지 변화 |
| Round 3 | 3개 | (와인2, 와인3, 와인4) | 27초 | 선택지 증가! |
| Round 4 | 3개 | (와인1, 와인4, 와인5) | 25초 | 압박 증가 |
| Round 5 | 4개 | (와인2, 와인3, 와인4, 와인5) | 22초 | 난이도 상승 |
| Round 6 | 5개 | (모든 와인) | 20초 | 클라이막스 |

**선택지 와인 조합:** 중복 조합으로 총 10가지 중 6개 라운드 선택

#### 2.1.3 게임 메커닉 상세

**플레이어 액션:**
- 조이스틱/화살표 버튼으로 포도알 캐릭터 이동
- 원하는 와인 쪽으로 이동 (화면상 와인병 근처)
- 타이머 종료 시 마지막 위치의 와인이 선택됨

**화면 구성:**
- 중앙: 포도알 캐릭터들 (각각 다른 색상)
- 좌/우 또는 사방: 선택할 와인들 (와인병 이미지 + 이름)
- 상단: 라운드 정보, 타이머
- 하단: 조이스틱 컨트롤

**결과 표시:**
- 각 라운드 종료 후 "누가 어느 와인을 선택했는가" 표시
- 예: "가희 → 라스피네타", "민준 → 샤르도네"

### 2.2 기록 및 통계 시스템

#### 2.2.1 게임 종료 후 자동 생성

게임 6라운드가 모두 끝나면 자동으로 **GameSession** 생성:

```
게임 기록 (자동 저장)
├─ 게임 날짜: 2025-12-15
├─ 참가자 수: 18명
├─ 와인별 기록
│  ├─ 라스피네타 깜페 2005: [가희, 민준, 준호, ...] (4명)
│  ├─ 샤르도네 2020: [수진, 은지, 광호, ...] (5명)
│  └─ ... (5개 와인)
└─ 개인별 기록
   ├─ 가희: {라스피네타: 3회, 샤르도네: 1회, ...}
   ├─ 민준: {라스피네타: 4회, 리슬링: 2회, ...}
   └─ ... (모든 참가자)
```

#### 2.2.2 통계 화면

**화면 1: 와인별 선택 통계**
```
🍷 라스피네타 깜페 2005
   선택한 사람: 가희, 민준, 준호, 지은 (4명)

🍷 샤르도네 2020
   선택한 사람: 수진, 은지, 광호, 영희, 다영 (5명)

... (모든 와인)
```

**화면 2: 개인별 선택 통계**
```
👤 가희의 선택 기록
   라스피네타: ⭐⭐⭐ (3회)
   샤르도네: ⭐ (1회)
   모스카또: ⭐⭐ (2회)

👤 민준의 선택 기록
   라스피네타: ⭐⭐⭐⭐ (4회)
   리슬링: ⭐⭐ (2회)
   ... 
```

#### 2.2.3 장기 기록 (향후 추가)
- 동호회 전체 모임 기록 조회 (날짜별)
- 멤버별 선호도 통계 (가장 많이 선택한 와인 등)
- 시계열 통계 (지난 6개월 와인 트렌드)

### 2.3 사용자 인터페이스

#### 2.3.1 마스터 인터페이스

**게임 시작 전:**
1. "새 게임 시작" 버튼
2. 와인 5개 등록 (이름 입력, 이미지 선택사항)
3. QR 코드 자동 생성 및 표시
4. "입장한 플레이어 수" 실시간 표시 (예: 18명 ✓)

**게임 진행 중:**
- 각 라운드마다 "라운드 시작" 버튼 (마스터만 클릭)
- 현재 라운드 번호, 선택지 와인 표시
- 참가자들의 포도알 움직임 실시간 표시 (마스터 화면)
- 타이머 (모든 사람이 동시에 보임)

**게임 종료:**
- 자동으로 기록 생성
- 통계 화면으로 전환

#### 2.3.2 플레이어 인터페이스

**입장 전:**
1. QR 코드 스캔 또는 방 ID 입력
2. 닉네임 입력 (예: "가희")
3. 대기 화면 (마스터가 시작할 때까지)

**게임 진행 중:**
1. 포도알 캐릭터 (랜덤 색상)
2. 선택지 와인들 (2-5개, 시각적으로 배치)
3. 조이스틱 컨트롤 (화살표 버튼 또는 터치 드래그)
4. 타이머
5. 다른 플레이어의 포도알 (다른 색상으로 표시)

**게임 종료:**
- 와인별/개인별 통계 자동 표시
- 공유 버튼 (선택사항)

---

## 3. 기술 요구사항

### 3.1 기술 스택

| 영역 | 기술 | 이유 |
|------|------|------|
| **Frontend** | React | 빠른 개발, 상태 관리 용이 |
| **Frontend 그래픽** | Canvas API (Phase 1), Pixi.js (Phase 4) | 2D 애니메이션, 포도알 렌더링 |
| **Frontend 실시간** | Socket.io-client | WebSocket, 실시간 멀티플레이 |
| **Frontend QR** | qrcode.react, jsQR | QR 코드 생성/스캔 |
| **Frontend UI** | Tailwind CSS | 빠른 스타일링 |
| **Backend** | Node.js + Express | 가볍고 빠름 |
| **Backend 실시간** | Socket.io | WebSocket 지원, 브로드캐스팅 용이 |
| **Database** | PostgreSQL (Neon) | 관계형 데이터, 신뢰성 |
| **Session 관리** | 메모리 (Redis 나중에 추가 가능) | 초기 규모에서 불필요 |
| **Deployment 백엔드** | Fly.io | WebSocket 지원, 저렴, $25 초기 크레딧 |
| **Deployment DB** | Neon | 무료 PostgreSQL |
| **Deployment 프론트** | Vercel | React 최적화, 무료 |

### 3.2 아키텍처

```
┌─────────────────────────────────────────┐
│         Frontend (React)                 │
│  - LoginScreen (닉네임)                 │
│  - GameRoom (게임 화면)                 │
│  - GameCanvas (포도알, 와인병)         │
│  - ResultScreen (통계)                  │
│  - Socket.io-client (실시간)            │
└────────────┬────────────────────────────┘
             │ WebSocket (Socket.io)
             ↓
┌─────────────────────────────────────────┐
│    Backend (Node.js + Express)          │
│  - Game Logic (라운드, 타이머)         │
│  - Room Management (방 관리)            │
│  - Socket.io (실시간 동기화)            │
│  - PostgreSQL (게임 기록)              │
│  - In-Memory Sessions (활성 게임)      │
└────────────┬────────────────────────────┘
             │ SQL
             ↓
┌─────────────────────────────────────────┐
│    PostgreSQL (Neon)                    │
│  - rooms (게임 방)                      │
│  - game_rounds (각 라운드)              │
│  - selections (플레이어 선택)          │
│  - game_sessions (게임 기록)           │
└─────────────────────────────────────────┘
```

### 3.3 데이터 모델

#### 3.3.1 Room (게임 방)
```javascript
{
  room_id: "abc123",           // QR 코드에 인코딩
  master_id: "user_1",
  status: "in_progress",       // waiting, in_progress, finished
  wines: [
    { id: 1, name: "라스피네타 깜페 2005", image_url: "..." },
    { id: 2, name: "샤르도네 2020", image_url: "..." },
    { id: 3, name: "모스카또 NV", image_url: "..." },
    { id: 4, name: "리슬링 2019", image_url: "..." },
    { id: 5, name: "네로 다볼라 2018", image_url: "..." }
  ],
  participants: [
    { player_id: "p1", nickname: "가희", color: "#FF5733" },
    { player_id: "p2", nickname: "민준", color: "#33FF57" },
    ...
  ],
  current_round: 1,
  created_at: "2025-12-15T10:30:00Z",
  finished_at: null
}
```

#### 3.3.2 GameRound (각 라운드)
```javascript
{
  room_id: "abc123",
  round_num: 1,
  wine_pair: [1, 2],           // wine_id 배열
  start_time: "2025-12-15T10:30:00Z",
  end_time: "2025-12-15T10:30:30Z",
  selections: {
    "p1": { wine_id: 1, timestamp: "..." },
    "p2": { wine_id: 2, timestamp: "..." },
    ...
  }
}
```

#### 3.3.3 GameSession (게임 기록)
```javascript
{
  room_id: "abc123",
  session_date: "2025-12-15",
  wines_info: {
    "1": {
      name: "라스피네타",
      selected_by: ["가희", "민준", "준호", "지은"]
    },
    "2": {
      name: "샤르도네",
      selected_by: ["수진", "은지", "광호", "영희", "다영"]
    },
    ...
  },
  player_stats: {
    "가희": {
      selections: [1, 1, 2, 1, 3, 5],
      selection_count: { "1": 3, "2": 1, "3": 1, "5": 1 }
    },
    "민준": {
      selections: [1, 2, 2, 4, 4, 1],
      selection_count: { "1": 2, "2": 2, "4": 2 }
    },
    ...
  },
  created_at: "2025-12-15T11:00:00Z"
}
```

### 3.4 Socket.io 이벤트

#### 클라이언트 → 서버 (emit)
```javascript
'join-room'              // 방 입장
'start-round'            // 라운드 시작 (마스터만)
'select-wine'            // 와인 선택
'move-character'         // 캐릭터 위치 업데이트 (Phase 4)
'game-end'              // 게임 종료
```

#### 서버 → 클라이언트 (broadcast)
```javascript
'round-start'            // 라운드 시작, 선택지 전달
'player-joined'          // 새 플레이어 입장
'selection-update'       // 플레이어 선택 실시간 표시
'character-move'         // 다른 플레이어의 캐릭터 이동 (Phase 4)
'round-end'             // 라운드 종료, 결과 표시
'game-finished'         // 게임 완료, 통계 전달
'timer-update'          // 타이머 동기화
```

---

## 4. 개발 계획

### 4.1 Phase 별 일정

#### **Phase 1: MVP - 핵심 게임 루프 (1주일)**
**목표:** 기본 게임 진행 가능

**백엔드:**
- [ ] Express 서버 기본 설정
- [ ] PostgreSQL 연결 (로컬 또는 Neon)
- [ ] 테이블 스키마 생성
- [ ] Socket.io 이벤트 (join, select, round-start, round-end)
- [ ] 게임 로직 (6라운드 자동 생성, 타이머)
- [ ] API: 방 생성, 플레이어 입장

**프론트엔드:**
- [ ] React 프로젝트 생성
- [ ] 로컬 스토리지에 닉네임 저장
- [ ] LoginScreen (닉네임 입력)
- [ ] GameRoom (게임 진행 화면)
- [ ] 와인 선택 버튼 (2-5개)
- [ ] 타이머 UI
- [ ] Socket.io 연결

**예상 결과:** 기본적인 게임 플레이 가능, 선택 결과 표시

---

#### **Phase 2: 게임 기록 + 통계 (3-4일)**
**목표:** 게임 종료 후 자동 기록 생성

**백엔드:**
- [ ] GameSession 자동 생성 로직
- [ ] 와인별/개인별 통계 계산
- [ ] API: 게임 기록 조회

**프론트엔드:**
- [ ] ResultScreen (와인별 통계)
- [ ] PlayerStatsScreen (개인별 통계)
- [ ] 통계 데이터 시각화

**예상 결과:** 게임 종료 후 자동으로 기록 생성, 통계 표시

---

#### **Phase 3: QR 코드 + 마스터 기능 (3-4일)**
**목표:** 간편한 참가, 마스터 컨트롤

**백엔드:**
- [ ] QR 코드 생성 API
- [ ] 방 ID 관리

**프론트엔드:**
- [ ] MasterPanel (와인 등록, 라운드 시작 버튼)
- [ ] QR 코드 표시 컴포넌트
- [ ] QR 코드 스캔 기능 (jsQR)
- [ ] 마스터 vs 플레이어 UI 분리

**예상 결과:** QR 스캔으로 간단히 입장, 마스터가 게임 제어

---

#### **Phase 4: 조이스틱 + Canvas 그래픽 (1주일)**
**목표:** 게임화된 비주얼 완성

**백엔드:**
- [ ] 포도알 위치 동기화 (Socket.io)
- [ ] 충돌 감지 로직

**프론트엔드:**
- [ ] Canvas에 포도알 렌더링
- [ ] 조이스틱 컨트롤 (화살표 or 터치 드래그)
- [ ] 포도알 이동 애니메이션
- [ ] 와인병 근처 감지
- [ ] 실시간 캐릭터 동기화

**예상 결과:** 완전한 게임화 경험, 포도알이 와인을 향해 이동

---

#### **Phase 5: 배포 (2-3일)**
- [ ] Fly.io 배포 (백엔드)
- [ ] Vercel 배포 (프론트엔드)
- [ ] Neon PostgreSQL 연결
- [ ] HTTPS 설정
- [ ] 환경변수 설정

**예상 결과:** 실제 모임에서 사용 가능

---

### 4.2 마일스톤

| 마일스톤 | 목표 날짜 | 결과 |
|---------|---------|------|
| Phase 1 완료 | +1주 | MVP 게임 시작 가능 |
| Phase 2 완료 | +1.5주 | 게임 기록 자동 생성 |
| Phase 3 완료 | +2주 | QR 입장 및 마스터 기능 |
| Phase 4 완료 | +3주 | 포도알 그래픽 완성 |
| **첫 모임 실행** | +3-4주 | 실제 와인 동호회 모임에서 테스트 |
| Phase 5 (배포) | +4주 | 프로덕션 배포 |

---

## 5. 비용 분석

### 5.1 개발 초기 비용

| 항목 | 비용 | 설명 |
|------|------|------|
| Fly.io | $0 | $25 초기 크레딧 (2-3개월 충분) |
| Neon PostgreSQL | $0 | 무료 tier (완전 무료) |
| Vercel | $0 | React 배포, 무료 |
| 총합 | **$0** | 초기 비용 없음 |

### 5.2 이후 월 비용

| 시나리오 | Fly.io | DB | 합계 |
|---------|--------|----|----|
| 저 사용 (주 2회 모임) | $5-7 | $0 | **$5-7/월** |
| 중 사용 (주 3-4회) | $10-15 | $0 | **$10-15/월** |
| 고 사용 (일일 사용) | $30+ | $0 | **$30+/월** |

**추천:** 처음 2-3개월은 무료 크레딧으로 충분. 이후 월 $5-10 정도 예상.

---

## 6. 성공 기준

### 6.1 MVP 성공 기준 (Phase 1-2)
- [ ] 15명 이상이 동시에 게임 참여 가능
- [ ] 30초 타이머 정확도 ±1초
- [ ] 게임 결과가 정확하게 기록됨
- [ ] 모든 플레이어가 동시에 같은 화면 본다 (동기화)

### 6.2 Phase 3-4 성공 기준
- [ ] QR 코드 스캔 후 3초 내 입장
- [ ] 포도알이 부드럽게 이동한다 (프레임 드롭 없음)
- [ ] 와인병 근처 감지 정확도 높음

### 6.3 최종 성공 기준
- [ ] 와인 동호회 실제 모임에서 성공적으로 실행
- [ ] 참가자들이 "재미있다"고 평가
- [ ] 모임마다 자동으로 와인 기록 생성

---

## 7. 향후 확장 기능 (나중에 추가)

### 7.1 단기 (1-2개월 후)
- [ ] 모임 기록 조회 (날짜별, 와인별)
- [ ] 멤버별 선호도 분석
- [ ] 게임 점수 시스템 (선택사항)
- [ ] 모바일 앱 (React Native)

### 7.2 중기 (3-6개월 후)
- [ ] 와인 정보 자동 가져오기 (Vivino API)
- [ ] 소셜 기능 (친구 추가, 비교)
- [ ] 고급 통계 (시계열, 트렌드)
- [ ] 사진 공유

### 7.3 장기
- [ ] 커뮤니티 기능 (다른 와인 클럽과 공유)
- [ ] AI 추천 (선호도 기반)
- [ ] 실시간 스트리밍 (모임 공유)

---

## 8. 리스크 및 대응

| 리스크 | 확률 | 영향 | 대응 |
|--------|------|------|------|
| WebSocket 타이밍 이슈 | 중 | 높음 | Phase 1에서 충분히 테스트 |
| 네트워크 지연 (WiFi) | 높음 | 중간 | 로컬 타이머 + 서버 동기화 |
| DB 데이터 손실 | 낮음 | 높음 | 정기 백업, Neon 신뢰성 |
| 모바일 브라우저 호환성 | 중 | 중간 | Chrome/Safari에서만 지원 |

---

## 9. 개발 환경 및 배포

### 9.1 로컬 개발 환경
```bash
# Backend
Node.js 16.x+
PostgreSQL 14.x+

# Frontend
Node.js 16.x+
npm or yarn

# 필수 도구
Git
VS Code (추천)
```

### 9.2 배포 환경

**프로덕션:**
```
Frontend:  Vercel (https://wine-game.vercel.app)
Backend:   Fly.io (https://wine-game-api.fly.dev)
Database:  Neon PostgreSQL
```

**개발:**
```
Frontend:  localhost:3000
Backend:   localhost:3001
Database:  localhost:5432 (로컬) 또는 Neon dev
```

---

## 10. 팀 구성

| 역할 | 담당자 | 책임 |
|------|--------|------|
| 전체 개발 | 가희 | 프론트엔드 + 백엔드 |
| 기획/디자인 | 가희 | UI/UX, 게임 메커닉 |

**주요 의존성:** 없음 (독립적 개발)

---

## 11. 참고 자료

### 11.1 유사 사례
- **Pikmin Bloom:** 위치 기반 게임, 캐릭터 이동
- **Balance Game (밸런스 게임):** 선택 게임의 결과 공유
- **Vivino/Wine Searcher:** 와인 정보 플랫폼

### 11.2 기술 문서
- Socket.io: https://socket.io/docs/
- PostgreSQL: https://www.postgresql.org/docs/
- React Canvas: https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API
- Fly.io Deploy: https://fly.io/docs/hands-on/start/

---

**문서 최종 검토:** 2025-12-15  
**다음 단계:** Phase 1 개발 시작 (백엔드부터)